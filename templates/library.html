{% extends "layout.html" %}
{% block content %}
<section class="featured-section">
  <div class="section-header">
    <h2>My Library</h2>
  </div>

  <div id="playlist-container">
    <div class="playlist-card-large" onclick="toggleSongList()">
      <div class="playlist-art">
        <i class="fas fa-heart"></i>
      </div>
      <div class="playlist-info">
        <h3>Liked Songs</h3>
        <p>{{ playlists[0].songs|length }} songs</p>
      </div>
      <div class="playlist-play-icon">
        <i class="fas fa-chevron-down"></i>
      </div>
    </div>

    <div id="song-list-container" class="song-list-vertical" style="display: none;">
      {% for song in playlists[0].songs %}
        <div class="song-list-item" 
             data-url="{{ url_for('stream_audio', file_id=song.file_id) }}"
             data-title="{{ song.title }}"
             data-artist="{{ song.artist }}"
             data-song-id="{{ song.id }}">
          <div class="song-item-art"> {# REMOVED onclick #}
            <i class="fas fa-music"></i>
            <div class="play-overlay-list"><i class="fas fa-play"></i></div>
          </div>
          <div class="song-item-details">
            <h4 class="song-title">{{ song.title }}</h4>
            <p class="song-meta">{{ song.artist }}</p>
          </div>
          <div class="song-item-actions">
            {% set is_liked = song.id|string in liked_song_ids|map('string') %}
            <button class="action-btn favorite-btn {{ 'liked' if is_liked }}"> {# ADDED liked class #}
              <i class="{{ 'fas' if is_liked else 'far' }} fa-heart"></i>
            </button>
          </div>
        </div>
      {% else %}
        <p class="empty-playlist-message">You haven't liked any songs yet.</p>
      {% endfor %}
    </div>
  </div>
</section>

<script>
  function toggleSongList() {
    const songList = document.getElementById('song-list-container');
    const icon = document.querySelector('.playlist-play-icon i');
    if (songList.style.display === 'none') {
      songList.style.display = 'block';
      icon.classList.remove('fa-chevron-down');
      icon.classList.add('fa-chevron-up');
    } else {
      songList.style.display = 'none';
      icon.classList.remove('fa-chevron-up');
      icon.classList.add('fa-chevron-down');
    }
  }
</script>
{% endblock %}