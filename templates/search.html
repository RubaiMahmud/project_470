{% extends "layout.html" %}
{% block content %}
<section class="featured-section">
  <div class="section-header">
    {% if query %}
      <h2>Search Results for "{{ query }}"</h2>
    {% else %}
      <h2>Search for Music</h2>
      <p class="search-prompt">Enter a song title, artist, or genre in the search bar above to find music.</p>
    {% endif %}
  </div>
  
  <div class="music-grid">
    {% for song in songs %}
    <div class="music-card" 
         data-url="{{ url_for('stream_audio', file_id=song.file_id) }}"
         data-title="{{ song.title }}"
         data-artist="{{ song.artist }}"
         data-album="{{ song.album or '' }}"
         data-genre="{{ song.genre }}"
         data-album-art-id="{{ song.album_art_id or '' }}"
         data-song-id="{{ song.id }}">
      <div class="music-card-image">
        {% if song.album_art_id %}
          <div class="album-art">
            <img src="{{ url_for('serve_album_art', file_id=song.album_art_id) }}" alt="{{ song.album or song.title }} Album Art">
          </div>
        {% else %}
          <div class="album-art"><i class="fas fa-music"></i></div>
        {% endif %}
        <div class="play-overlay">
          <button class="card-play-btn">
            <i class="fas fa-play"></i>
          </button>
        </div>
      </div>
      
      <div class="music-card-content">
        <h3 class="song-title">{{ song.title }}</h3>
        <p class="song-meta">
          <a href="{{ url_for('artist_page', artist_name=song.artist|urlencode) }}" class="artist-link">{{ song.artist }}</a>{% if song.album %} • {{ song.album }}{% endif %} • {{ song.genre }}
        </p>
        
        <div class="card-actions">
          {% set is_liked = song.id|string in liked_song_ids|map('string') %}
          <button class="action-btn favorite-btn {{ 'liked' if is_liked }}">
            <i class="{{ 'fas' if is_liked else 'far' }} fa-heart"></i>
          </button>
          {% if current_user.is_authenticated and current_user.is_admin %}
            <a href="{{ url_for('edit_song', song_id=song.id) }}" class="action-btn edit-btn">
              <i class="fas fa-edit"></i> Edit
            </a>
            <form method="POST" action="{{ url_for('delete_song', song_id=song.id) }}" onsubmit="return confirm('Are you sure?');" style="display: inline;">
              <button type="submit" class="action-btn delete-btn"><i class="fas fa-trash"></i></button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  
  {% if query and not songs %}
  <div class="empty-state">
    <i class="fas fa-search"></i>
    <h3>No Results Found</h3>
    <p>We couldn't find any songs matching your search for "{{ query }}".</p>
    <p>Try searching for something else!</p>
  </div>
  {% endif %}
</section>
{% endblock %}
